<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sora 批量注册</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div id="app">
    <div id="login-page" class="page">
      <div class="login-box">
        <h1>Sora 批量注册</h1>
        <form id="login-form">
          <input type="text" id="login-username" placeholder="账号" required autocomplete="username" />
          <input type="password" id="login-password" placeholder="密码" required autocomplete="current-password" />
          <button type="submit">登录</button>
        </form>
        <p id="login-error" class="error"></p>
      </div>
    </div>
    <div id="admin-page" class="page hidden layout-sidebar">
      <aside class="sidebar collapsed" id="sidebar">
        <div class="sidebar-header">
          <div class="logo"><span class="logo-icon" aria-hidden="true">S</span><span class="logo-text">Sora 批量注册</span></div>
          <button type="button" class="sidebar-toggle sidebar-toggle-in-header" id="sidebar-toggle" title="展开/收起菜单" aria-label="展开或收起侧栏"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg></button>
        </div>
        <nav class="nav">
          <a href="#" data-tab="logs" title="批量注册"><span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg></span><span class="nav-text">批量注册</span></a>
          <a href="#" data-tab="accounts" title="账号管理"><span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg></span><span class="nav-text">账号管理</span></a>
          <a href="#" data-tab="emails" title="邮箱管理"><span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></span><span class="nav-text">邮箱管理</span></a>
          <a href="#" data-tab="bank-cards" title="银行卡管理"><span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg></span><span class="nav-text">银行卡管理</span></a>
          <a href="#" data-tab="phones" title="手机号管理"><span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="5" y="2" width="14" height="20" rx="2"/><line x1="12" y1="18" x2="12.01" y2="18"/></svg></span><span class="nav-text">手机号管理</span></a>
          <a href="#" data-tab="settings" title="系统设置"><span class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></span><span class="nav-text">系统设置</span></a>
        </nav>
        <div class="sidebar-footer">
          <a class="sidebar-link" href="https://qm.qq.com/cgi-bin/qm/qr?k=382446" target="_blank" rel="noopener"><span class="nav-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg></span><span class="footer-text">QQ群 382446</span></a>
          <a class="sidebar-link" href="https://github.com/432539/Sora-Register" target="_blank" rel="noopener"><span class="nav-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/></svg></span><span class="footer-text">仓库地址</span></a>
          <span class="user-name user-name-clickable" id="current-user" title="点击修改账号密码"><span class="user-name-icon" aria-hidden="true"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="8" cy="15" r="4"/><path d="M10.85 12.15L19 4"/><path d="M18 5l2 2"/><path d="M15 8l2 2"/></svg></span><span class="user-name-text"></span></span>
          <button type="button" id="btn-logout" class="btn-logout">退出</button>
          <button type="button" class="sidebar-toggle sidebar-toggle-in-footer" id="sidebar-toggle-footer" title="展开/收起菜单" aria-label="展开或收起侧栏"><span class="nav-icon"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg></span><span class="toggle-footer-text">收起</span></button>
        </div>
      </aside>
      <main class="main">
        <section id="panel-accounts" class="panel">
          <h2>账号管理</h2>
          <p id="accounts-db-hint" class="db-hint" style="margin:0 0 0.75rem 0;font-size:0.85rem;color:var(--text-muted, #888);"></p>
          <div class="toolbar">
            <label>状态 <select id="filter-status"><option value="">全部</option><option value="Registered">已注册</option><option value="Registered+Sora">Sora</option><option value="Plus activated">Plus</option></select></label>
            <label>SORA <select id="filter-sora"><option value="">全部</option><option value="true">是</option><option value="false">否</option></select></label>
            <label>PLUS <select id="filter-plus"><option value="">全部</option><option value="true">是</option><option value="false">否</option></select></label>
            <button type="button" id="btn-export-accounts">批量导出 CSV</button>
          </div>
          <div class="table-wrap">
            <table class="data-table">
              <thead><tr><th>ID</th><th>邮箱</th><th title="ChatGPT 登录密码，非邮箱密码">GPT密码</th><th>状态</th><th>SORA</th><th>PLUS</th><th>手机</th><th>RT</th><th>注册时间</th></tr></thead>
              <tbody id="accounts-tbody"></tbody>
            </table>
          </div>
          <div class="pagination" id="accounts-pagination"></div>
        </section>
        <section id="panel-emails" class="panel hidden">
          <h2>邮箱管理</h2>
          <div class="email-api-card">
            <h3>从 Hotmail007 拉取</h3>
            <p class="email-api-desc">需在 <a href="#" id="link-to-settings">系统设置</a> 中配置邮箱 API 地址与 KEY（clientKey）。<a href="https://hotmail007.com/zh/apiDoc" target="_blank" rel="noopener">API 文档</a>（单个 $0.0015/账号 - $0.02/账号）</p>
            <div class="email-api-row">
              <span>余额：<strong id="email-api-balance">--</strong></span>
              <label>类型 <select id="email-api-mail-type"><option value="outlook">outlook</option><option value="hotmail">hotmail</option><option value="hotmail Trusted">hotmail 可信（有效期 3-6 个月）</option><option value="outlook Trusted">outlook 可信（有效期 3-6 个月）</option></select></label>
              <label>数量 <input type="number" id="email-api-quantity" min="1" max="100" value="1" /></label>
              <button type="button" id="btn-email-api-stock">查询库存</button>
              <button type="button" id="btn-email-api-fetch">拉取并导入</button>
            </div>
            <p id="email-api-msg" class="email-api-msg"></p>
          </div>
          <div class="toolbar">
            <button type="button" id="btn-add-email">添加</button>
            <button type="button" id="btn-batch-import-email">批量导入</button>
            <button type="button" id="btn-batch-export-email">批量导出</button>
          </div>
          <div class="table-wrap">
            <table class="data-table">
              <thead><tr><th>ID</th><th>邮箱</th><th>密码</th><th>UUID</th><th>状态</th><th>操作</th></tr></thead>
              <tbody id="emails-tbody"></tbody>
            </table>
          </div>
        </section>
        <section id="panel-bank-cards" class="panel hidden">
          <h2>银行卡管理</h2>
          <div class="toolbar">
            <button type="button" id="btn-add-card">添加</button>
            <button type="button" id="btn-batch-import-card">批量导入</button>
            <button type="button" id="btn-batch-delete-card">批量删除</button>
          </div>
          <div class="table-wrap">
            <table class="data-table">
              <thead><tr><th><input type="checkbox" id="check-all-cards" /></th><th>ID</th><th>卡号(掩码)</th><th>使用次数</th><th>备注</th><th>操作</th></tr></thead>
              <tbody id="cards-tbody"></tbody>
            </table>
          </div>
        </section>
        <section id="panel-phones" class="panel hidden">
          <h2>手机号管理</h2>
          <p class="panel-desc">手机号绑定数在 <a href="#" id="link-to-settings-phones">系统设置</a> 中配置「手机号绑定数」；批量导入时自动应用该默认值。</p>
          <div class="email-api-card">
            <h3>Hero-SMS 接码（OpenAI）</h3>
            <p class="email-api-desc">需在系统设置中配置手机号接码 API 地址与 KEY。<a href="https://hero-sms.com/cn/api" target="_blank" rel="noopener">API 文档</a></p>
            <div class="email-api-row">
              <span>余额：<strong id="sms-api-balance">--</strong></span>
              <button type="button" id="btn-sms-api-test">测试接口</button>
              <span>OpenAI 可用数量：<strong id="sms-api-openai-count">--</strong></span>
              <button type="button" id="btn-sms-api-refresh-openai">查询</button>
              <button type="button" id="btn-sms-api-debug-prices" class="btn-default">查看原始数据</button>
              <button type="button" id="btn-sms-api-services" class="btn-default">服务列表</button>
              </div>
            <div class="email-api-row" style="margin-top:0.5rem;">
              <label>获取数量 <input type="number" id="sms-api-get-quantity" min="1" max="20" value="1" /></label>
              <label>国家 ID <input type="number" id="sms-api-country" value="16" placeholder="16=英国" style="width:80px;" title="16=英国，0=自动" /></label>
              <button type="button" id="btn-sms-api-get-numbers">获取 OpenAI 号码</button>
            </div>
            <p id="sms-api-msg" class="email-api-msg"></p>
          </div>
          <div class="toolbar">
            <button type="button" id="btn-add-phone">添加</button>
            <button type="button" id="btn-batch-import-phone">批量导入</button>
            <button type="button" id="btn-batch-delete-phone">批量删除</button>
          </div>
          <div class="table-wrap">
            <table class="data-table">
              <thead><tr><th><input type="checkbox" id="check-all-phones" /></th><th>ID</th><th>手机号</th><th>已绑定/上限</th><th>到期时间</th><th>备注</th><th>操作</th></tr></thead>
              <tbody id="phones-tbody"></tbody>
            </table>
          </div>
        </section>
        <section id="panel-logs" class="panel hidden">
          <h2>批量注册</h2>
          <div class="dashboard-card">
            <div class="dashboard-actions">
              <button type="button" id="btn-start-register" class="btn-dash btn-primary">开启注册</button>
              <button type="button" id="btn-stop-register" class="btn-dash btn-secondary" style="display:none;">停止任务</button>
              <button type="button" id="btn-start-bind-phone" class="btn-dash btn-secondary">开始绑定手机</button>
              <button type="button" id="btn-stop-bind-phone" class="btn-dash btn-secondary" style="display:none;">停止绑定</button>
              <button type="button" id="btn-start-plus" class="btn-dash btn-secondary">开始开通 Plus</button>
              <span id="register-status-heartbeat" class="register-heartbeat" style="display:none;"></span>
            </div>
            <div class="dashboard-stats">
              <div class="stat-item"><span class="stat-label">今日注册</span><span class="stat-value" id="dash-today">0</span></div>
              <div class="stat-item"><span class="stat-label">合计注册</span><span class="stat-value" id="dash-total">0</span></div>
              <div class="stat-item"><span class="stat-label">绑定手机</span><span class="stat-value" id="dash-phone">0</span></div>
              <div class="stat-item"><span class="stat-label">开通 Plus</span><span class="stat-value" id="dash-plus">0</span></div>
              <div class="stat-item"><span class="stat-label">成功</span><span class="stat-value stat-ok" id="dash-success">0</span></div>
              <div class="stat-item"><span class="stat-label">失败</span><span class="stat-value stat-fail" id="dash-fail">0</span></div>
              <div class="stat-item"><span class="stat-label">邮箱 API</span><span class="stat-value stat-value-muted" id="dash-email-api">—</span></div>
              <div class="stat-item"><span class="stat-label">手机号 API</span><span class="stat-value stat-value-muted" id="dash-sms-api">—</span></div>
              <div class="stat-item"><span class="stat-label">银行卡 API</span><span class="stat-value stat-value-muted" id="dash-bank-api">—</span></div>
              <div class="stat-item"><span class="stat-label">打码 API</span><span class="stat-value stat-value-muted" id="dash-captcha-api">—</span></div>
              <div class="stat-item"><span class="stat-label">线程数</span><span class="stat-value" id="dash-threads">1</span></div>
            </div>
          </div>
          <div class="log-panel">
            <div class="log-panel-header">
              <span class="log-panel-title" id="log-panel-title">最近 20 条日志</span>
              <div class="log-panel-actions">
                <button type="button" id="btn-refresh-dashboard" class="log-panel-refresh" title="刷新">刷新</button>
                <button type="button" id="btn-clear-logs" class="log-panel-refresh log-panel-clear" title="清空">清空</button>
              </div>
            </div>
            <div class="log-panel-expand" id="log-expand-area"></div>
            <div class="log-list log-list-fixed" id="log-list"></div>
          </div>
        </section>
        <section id="panel-settings" class="panel hidden">
          <h2>系统设置</h2>
          <form id="settings-form" class="settings-grid">
            <div class="settings-card">
              <h3>手机号接码 API</h3>
              <p class="settings-card-desc">支持 Hero-SMS（SMS-Activate 兼容）。<a href="https://hero-sms.com/cn/api" target="_blank" rel="noopener">API 文档</a></p>
              <label>API 地址 <input type="text" name="sms_api_url" placeholder="https://hero-sms.com/stubs/handler_api.php" /></label>
              <label>KEY (api_key) <input type="password" name="sms_api_key" placeholder="Hero-SMS API Key" autocomplete="off" /></label>
              <label>OpenAI 服务 ID <input type="text" name="sms_openai_service" placeholder="dr（Hero-SMS 中 OpenAI 的 code）" title="接码平台服务列表里 OpenAI 对应 code，Hero-SMS 为 dr" /></label>
              <label>获取号码最高价 (maxPrice) <input type="number" name="sms_max_price" placeholder="0.55" min="0" step="0.01" title="getNumberV2 时仅接受不高于此价的号码" /></label>
            </div>
            <div class="settings-card">
              <h3>邮箱 API</h3>
              <label>API 地址 <input type="text" name="email_api_url" placeholder="https://gapi.hotmail007.com" /></label>
              <label>KEY (clientKey) <input type="password" name="email_api_key" placeholder="Hotmail007 clientKey" autocomplete="off" /></label>
              <label>默认邮箱类型 <select name="email_api_default_type"><option value="outlook">outlook</option><option value="hotmail">hotmail</option><option value="hotmail Trusted">hotmail 可信（3-6 个月）</option><option value="outlook Trusted">outlook 可信（3-6 个月）</option></select></label>
            </div>
            <div class="settings-card">
              <h3>银行卡 API</h3>
              <label>平台 <select name="bank_card_api_platform"><option value="寻汇">寻汇</option><option value="万里汇">万里汇</option><option value="空中云汇">空中云汇</option></select></label>
              <label>API 地址 <input type="text" name="bank_card_api_url" placeholder="https://..." /></label>
              <label>KEY <input type="password" name="bank_card_api_key" placeholder="API Key" autocomplete="off" /></label>
            </div>
            <div class="settings-card">
              <h3>代理 IP</h3>
              <label>单代理地址 <input type="text" name="proxy_url" placeholder="http://127.0.0.1:7890" /></label>
              <label>代理 API 地址 <input type="text" name="proxy_api_url" placeholder="从 API 获取代理列表" /></label>
            </div>
            <div class="settings-card">
              <h3>打码 API</h3>
              <p class="settings-card-desc">开通 Plus 等流程中会遇到 hCaptcha，可使用 <a href="https://2captcha.com/" target="_blank" rel="noopener">2Captcha</a> 打码。</p>
              <label>API 地址 <input type="text" name="captcha_api_url" placeholder="https://2captcha.com" /></label>
              <label>API KEY <input type="password" name="captcha_api_key" placeholder="2Captcha API Key" autocomplete="off" /></label>
            </div>
            <div class="settings-card">
              <h3>OAuth / 注册换 Token</h3>
              <p class="settings-card-desc">填写 OAuth Client ID 后，注册成功会先尝试从 callback 取 code 换 token；若无则自动再走一遍「邮箱+密码」登录，用 redirect_uri=http://localhost:1455/auth/callback 从 302 取 code 换 AT/RT 并写入账号管理。OAuth 应用需允许该 redirect_uri。</p>
              <label>OAuth Client ID <input type="text" name="oauth_client_id" placeholder="OpenAI OAuth 应用 client_id" autocomplete="off" /></label>
              <label>OAuth Redirect URI <input type="text" name="oauth_redirect_uri" placeholder="留空则用 https://chatgpt.com/（登录取 code 时固定用 localhost:1455）" /></label>
            </div>
            <div class="settings-card">
              <h3>运行参数</h3>
              <div class="settings-row-2">
                <label>线程数 <input type="number" name="thread_count" min="1" placeholder="1" /></label>
                <label>重试次数 <input type="number" name="retry_count" min="1" max="5" placeholder="2" title="单条注册失败后重试次数，1-5" /></label>
              </div>
              <div class="settings-row-2">
                <label>每卡使用次数 <input type="number" name="card_use_limit" min="1" placeholder="1" /></label>
                <label>手机号绑定数 <input type="number" name="phone_bind_limit" min="1" placeholder="1" /></label>
              </div>
            </div>
            <div class="settings-submit">
              <button type="submit">保存全部</button>
            </div>
          </form>
        </section>
      </main>
    </div>
  </div>
  <div id="modal" class="modal hidden">
    <div class="modal-content">
      <span class="modal-close">&times;</span>
      <div id="modal-body"></div>
    </div>
  </div>
  <div id="toast-container" class="toast-container"></div>
  <script src="/static/app.js"></script>
</body>
</html>
